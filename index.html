<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Reporte Ambiental</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

    <link rel="stylesheet" href="estilos.css" />

    <!-- Google reCAPTCHA -->
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
  </head>

  <body>
    <header>
      <h1>Reporta un problema ambiental cerca de ti</h1>
    </header>

    <section id="map-section">
      <h2>Tu ubicación</h2>
      <div id="map"></div>
    </section>

    <section>
      <h2 style="margin-left: 25px;">Verifica que no eres un robot</h2>
      <div
        class="g-recaptcha"
        data-sitekey="6LeMKgIsAAAAADO_holfWYxbsFSFwMCwXALF7Ptx"
        data-callback="mostrarFormulario"
      ></div>
    </section>

    <section id="form-section">
      <h2>Formulario de reporte</h2>
      <form id="report-form" onsubmit="return validateCaptcha()">
        <input type="text" name="nombre" placeholder="Tu nombre" required />
        <input type="email" name="email" placeholder="Tu correo" required />
        <select name="tipo" required>
          <option value="">Tipo de problema</option>
          <option value="basura">Basura</option>
          <option value="contaminación">Contaminación</option>
          <option value="incendio">Incendio forestal</option>
          <option value="otro">Otro</option>
        </select>
        <textarea
          name="descripcion"
          placeholder="Describe el problema"
          required
        ></textarea>
        <button type="submit">Enviar reporte</button>
      </form>
    </section>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    <script>
      // Mostrar formulario cuando el captcha se valida
      function mostrarFormulario() {
        document.getElementById("form-section").style.display = "block";
      }

      // Validar captcha antes de enviar
      function validateCaptcha() {
        const response = grecaptcha.getResponse();
        if (response.length === 0) {
          alert("Por favor verifica el captcha.");
          return false;
        }
        alert("Reporte enviado correctamente.");
        return true;
      }

      // Mapa con geolocalización
      window.onload = function () {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            function (position) {
              const lat = position.coords.latitude;
              const lon = position.coords.longitude;
              const map = L.map("map").setView([lat, lon], 13);

              L.tileLayer(
                "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
                {
                  attribution: "&copy; OpenStreetMap contributors",
                  maxZoom: 19,
                  minZoom: 3,
                }
              ).addTo(map);

              L.marker([lat, lon])
                .addTo(map)
                .bindPopup("Tu ubicación actual")
                .openPopup();
            },
            function (error) {
              if (error.code === error.PERMISSION_DENIED) {
                alert(
                  "Debes permitir el acceso a tu ubicación para usar el mapa."
                );
              } else {
                alert("Error obteniendo ubicación: " + error.message);
              }
            }
          );
        } else {
          alert("La geolocalización no está disponible en tu navegador.");
        }
      };
    </script>
  </body>
</html>
